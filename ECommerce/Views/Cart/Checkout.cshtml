@{
    ViewBag.Title = "Checkout";
}

<div class="section" style="max-width: 1000px; margin: 0 auto;">
    <div style="margin-bottom: 2rem; text-align: center;">
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Checkout</h1>
        <p>Complete your order</p>
    </div>

    <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 2rem;">
        <!-- Checkout Form -->
        <div style="display: flex; flex-direction: column; gap: 2rem;">
            <!-- Shipping Info -->
            <div class="card" style="padding: 2rem;">
                <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                    <div style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem;">1</div>
                    Shipping Information
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div class="form-group">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" placeholder="John">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" placeholder="Doe">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" placeholder="john@example.com">
                </div>

                <div class="form-group">
                    <label class="form-label">Street Address</label>
                    <input type="text" class="form-control" placeholder="123 Main St">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" placeholder="New York">
                    </div>
                    <div class="form-group">
                        <label class="form-label">State</label>
                        <input type="text" class="form-control" placeholder="NY">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Zip Code</label>
                        <input type="text" class="form-control" placeholder="10001">
                    </div>
                </div>
            </div>

            <!-- Payment Info -->
            <div class="card" style="padding: 2rem;">
                <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                    <div style="width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem;">2</div>
                    Payment Details
                </h3>

                <div class="form-group">
                    <label class="form-label">Card Number</label>
                    <div style="position: relative;">
                        <input type="text" class="form-control" placeholder="0000 0000 0000 0000" style="padding-left: 3rem;">
                        <i class="ph-fill ph-credit-card" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 1.25rem;"></i>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Expiry Date</label>
                        <input type="text" class="form-control" placeholder="MM/YY">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CVC</label>
                        <input type="text" class="form-control" placeholder="123">
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary Sidebar -->
        <div class="card" style="padding: 2rem; height: fit-content; position: sticky; top: 100px;">
            <h3 style="margin-bottom: 1.5rem;">Order Summary</h3>
            <div id="checkout-items" style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem; max-height: 300px; overflow-y: auto;">
                <!-- Items injected via JS -->
            </div>

            <div style="height: 1px; background: var(--border); margin-bottom: 1.5rem;"></div>

            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="color: var(--text-muted);">Subtotal</span>
                <span id="chk-subtotal" style="font-weight: 600;">$0.00</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span style="color: var(--text-muted);">Tax (5%)</span>
                <span id="chk-tax" style="font-weight: 600;">$0.00</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 700; margin-top: 1rem;">
                <span>Total</span>
                <span id="chk-total">$0.00</span>
            </div>

            <button id="place-order-btn" class="btn btn-primary" style="width: 100%; margin-top: 2rem; padding: 1rem;">
                Place Order
            </button>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="success-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 2000; align-items: center; justify-content: center;">
    <div class="card animate-fade-in" style="padding: 3rem; text-align: center; max-width: 500px;">
        <div style="width: 80px; height: 80px; background: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: #166534;">
            <i class="ph-fill ph-check" style="font-size: 3rem;"></i>
        </div>
        <h2 style="margin-bottom: 1rem;">Order Placed Successfully!</h2>
        <p style="color: var(--text-muted); margin-bottom: 2rem;">Thank you for your purchase. Your order #ORD-2023-001 has been confirmed.</p>
        <a href="@Url.Action("Index", "Home")" class="btn btn-primary" onclick="clearCart()">Continue Shopping</a>
    </div>
</div>

<script>
    const cart = JSON.parse(localStorage.getItem("checkedProducts")) || [];
    const itemsContainer = document.getElementById('checkout-items');
    let subtotal = 0;

    // Render Summary
    cart.forEach(item => {
        subtotal += item.totalPrice;
        const div = document.createElement('div');
        div.style.display = 'flex';
        div.style.justifyContent = 'space-between';
        div.style.alignItems = 'center';
        div.innerHTML = `
            <div style="display: flex; gap: 0.75rem; align-items: center;">
                <div style="position: relative;">
                    <img src="${item.img}" style="width: 40px; height: 40px; object-fit: contain; background: #f9fafb; border-radius: var(--radius-sm);">
                    <span style="position: absolute; top: -5px; right: -5px; background: var(--text-muted); color: white; font-size: 0.7rem; width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">${item.amount}</span>
                </div>
                <span style="font-size: 0.9rem;">${item.name}</span>
            </div>
            <span style="font-weight: 600; font-size: 0.9rem;">$${item.totalPrice}</span>
        `;
        itemsContainer.appendChild(div);
    });

    const tax = subtotal * 0.05;
    const total = subtotal + tax;

    document.getElementById('chk-subtotal').textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById('chk-tax').textContent = `$${tax.toFixed(2)}`;
    document.getElementById('chk-total').textContent = `$${total.toFixed(2)}`;

    // Place Order Logic
    document.getElementById('place-order-btn').addEventListener('click', function() {
        // Simulate processing
        this.innerHTML = '<i class="ph-bold ph-spinner ph-spin"></i> Processing...';
        this.disabled = true;

        setTimeout(() => {
            document.getElementById('success-modal').style.display = 'flex';
        }, 1500);
    });

    window.clearCart = function() {
        localStorage.removeItem("checkedProducts");
    };
</script>
