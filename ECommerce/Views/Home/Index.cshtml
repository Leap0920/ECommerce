@{
    ViewBag.Title = "Home Page";
}

<!-- Hero Section -->
<section class="section" style="padding-top: 2rem;">
    <div class="card" style="background: linear-gradient(135deg, #d8f3dc 0%, #ffffff 100%); border: none; padding: 4rem; display: flex; align-items: center; justify-content: space-between; position: relative; overflow: hidden;">
        <div style="max-width: 500px; z-index: 1;">
            <span style="color: var(--primary); font-weight: 600; letter-spacing: 1px; text-transform: uppercase; font-size: 0.9rem;">100% Organic</span>
            <h1 style="margin: 1rem 0; font-size: 3.5rem; color: var(--text-main);">Fresh & Healthy Vegetables</h1>
            <p style="font-size: 1.1rem; margin-bottom: 2rem; color: var(--text-muted);">
                Get farm-fresh organic produce delivered straight to your door. Quality you can trust, taste you will love.
            </p>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-primary">Shop Now</button>
                <button class="btn btn-outline">Learn More</button>
            </div>
        </div>
        <div style="position: relative; z-index: 1;">
            <!-- Hero Image Placeholder -->
            <img src="~/Content/Images/Products/basket-full.png" onerror="this.src='https://placehold.co/400x400/e2e8f0/1e293b?text=Fresh+Veg'" alt="Fresh Vegetables" style="width: 400px; height: auto; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.1)); transform: rotate(-5deg);">
        </div>
        
        <!-- Decorative Background Elements -->
        <div style="position: absolute; top: -50px; right: -50px; width: 300px; height: 300px; background: rgba(45, 106, 79, 0.05); border-radius: 50%;"></div>
        <div style="position: absolute; bottom: -20px; left: 40%; width: 150px; height: 150px; background: rgba(45, 106, 79, 0.03); border-radius: 50%;"></div>
    </div>
</section>

<!-- Features Section -->
<section style="padding: 2rem 0; display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem;">
    <div class="card" style="padding: 2rem; text-align: center; border: none; background: transparent;">
        <div style="width: 60px; height: 60px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: var(--primary);">
            <i class="ph-fill ph-truck" style="font-size: 1.5rem;"></i>
        </div>
        <h3>Free Delivery</h3>
        <p>On all orders over $50</p>
    </div>
    <div class="card" style="padding: 2rem; text-align: center; border: none; background: transparent;">
        <div style="width: 60px; height: 60px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: var(--primary);">
            <i class="ph-fill ph-shield-check" style="font-size: 1.5rem;"></i>
        </div>
        <h3>Secure Payment</h3>
        <p>100% secure payment</p>
    </div>
    <div class="card" style="padding: 2rem; text-align: center; border: none; background: transparent;">
        <div style="width: 60px; height: 60px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: var(--primary);">
            <i class="ph-fill ph-headset" style="font-size: 1.5rem;"></i>
        </div>
        <h3>24/7 Support</h3>
        <p>Dedicated support</p>
    </div>
</section>

<!-- Products Section -->
<section class="section" id="products">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <h2 style="margin-bottom: 0.5rem;">Our Products</h2>
            <p>Hand-picked fresh for you</p>
        </div>
        
        <!-- Filter Controls -->
        <div style="display: flex; gap: 1rem; align-items: center;">
            <div class="form-group" style="margin-bottom: 0;">
                <select class="form-control filter-vege" style="width: 200px;">
                    <option value="all">All Categories</option>
                    <option value="leafy">Leafy Vegetables</option>
                    <option value="root">Root Vegetables</option>
                    <option value="fruit">Fruit Vegetables</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" id="search-bar" class="form-control" placeholder="Search products..." style="width: 250px;">
            </div>
        </div>
    </div>

    <!-- Product Grid -->
    <div class="main-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 2rem;">
        <!-- Products injected via JS -->
    </div>
</section>

<!-- Product Modal -->
<div class="popup-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center;">
    <div class="product-view card" style="width: 900px; padding: 0; display: flex; flex-direction: row; overflow: hidden;">
        <!-- Content injected via JS -->
    </div>
</div>

<!-- Modal moved to bottom -->

<script type="module">
    // Fetch Data
    let res = await fetch("../Content/Data/vegs.json");
    let data = await res.json();
    let mainGrid = document.querySelector(".main-grid");
    let checkedProducts = JSON.parse(localStorage.getItem("checkedProducts")) || [];

    // Initial Display
    displayer(data);

    // Search Logic
    document.getElementById("search-bar").addEventListener("input", function(e) {
        let val = e.target.value.toLowerCase();
        let filtered = data.filter(d => d.name.toLowerCase().includes(val));
        displayer(filtered);
    });

    // Filter Logic
    document.querySelector(".filter-vege").addEventListener("change", function(e) {
        let val = e.target.value;
        if (val === "all") displayer(data);
        else displayer(data.filter(d => d.type === val));
    });

    // Display Function
    function displayer(items) {
        mainGrid.innerHTML = "";
        items.forEach(item => {
            let card = document.createElement("div");
            card.className = "card animate-fade-in";
            card.style.padding = "1.5rem";
            card.style.display = "flex";
            card.style.flexDirection = "column";
            card.style.gap = "1rem";
            card.style.cursor = "pointer";

            card.innerHTML = `
                <div style="position: relative; height: 200px; display: flex; align-items: center; justify-content: center; background: #f8fafc; border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                    <img src="${item.image}" alt="${item.name}" style="max-width: 80%; max-height: 80%; object-fit: contain; transition: transform 0.3s;">
                    <button class="icon-btn" style="position: absolute; top: 10px; right: 10px; background: white; box-shadow: var(--shadow-sm);">
                        <i class="ph ph-heart"></i>
                    </button>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3 style="font-size: 1.1rem; margin: 0;">${item.name}</h3>
                        <span style="font-weight: 700; color: var(--primary);">$${item.price}</span>
                    </div>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${item.description}</p>
                </div>
                <button class="btn btn-outline add-btn" style="width: 100%; margin-top: auto;">
                    <i class="ph-bold ph-shopping-cart" style="margin-right: 0.5rem;"></i> Add to Cart
                </button>
            `;

            // Click Event for Modal
            card.querySelector("img").addEventListener("click", () => openModal(item));
            card.querySelector("h3").addEventListener("click", () => openModal(item));

            // Add to Cart Event
            card.querySelector(".add-btn").addEventListener("click", (e) => {
                e.stopPropagation();
                addToCart(item, 1);
            });

            mainGrid.appendChild(card);
        });
    }

    // Modal Logic
    const modal = document.querySelector(".popup-container");
    const modalContent = document.querySelector(".product-view");

    function openModal(item) {
        modal.style.display = "flex";
        let qty = 1;
        
        modalContent.innerHTML = `
            <div style="flex: 1; background: #f8fafc; padding: 3rem; display: flex; align-items: center; justify-content: center;">
                <img src="${item.image}" style="max-width: 100%; max-height: 300px; object-fit: contain;">
            </div>
            <div style="flex: 1; padding: 3rem; display: flex; flex-direction: column; gap: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <span style="color: var(--primary); font-weight: 600; text-transform: uppercase; font-size: 0.85rem;">${item.type}</span>
                        <h2 style="margin: 0.5rem 0;">${item.name}</h2>
                    </div>
                    <button id="close-modal" class="icon-btn"><i class="ph-bold ph-x"></i></button>
                </div>
                
                <h3 style="color: var(--primary); font-size: 2rem;">$${item.price}</h3>
                <p style="color: var(--text-muted); line-height: 1.7;">${item.description}</p>
                
                <div style="margin-top: auto;">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; border: 1px solid var(--border); border-radius: var(--radius-sm);">
                            <button class="icon-btn" id="minus" style="border-radius: 0;">-</button>
                            <span id="qty-display" style="width: 40px; text-align: center; font-weight: 600;">1</span>
                            <button class="icon-btn" id="plus" style="border-radius: 0;">+</button>
                        </div>
                        <button class="btn btn-primary" id="modal-add" style="flex: 1;">Add to Cart - $${item.price}</button>
                    </div>
                </div>
            </div>
        `;

        // Modal Events
        document.getElementById("close-modal").onclick = () => modal.style.display = "none";
        
        document.getElementById("plus").onclick = () => {
            qty++;
            updateModalQty(qty, item.price);
        };
        
        document.getElementById("minus").onclick = () => {
            if (qty > 1) qty--;
            updateModalQty(qty, item.price);
        };

        document.getElementById("modal-add").onclick = () => {
            addToCart(item, qty);
            modal.style.display = "none";
        };
    }

    function updateModalQty(q, price) {
        document.getElementById("qty-display").textContent = q;
        document.getElementById("modal-add").textContent = `Add to Cart - $${q * price}`;
    }

    // Close modal on outside click
    modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.style.display = "none";
    });

    // Cart Logic
    function addToCart(item, quantity) {
        let existing = checkedProducts.find(p => p.name === item.name);
        
        if (existing) {
            existing.amount += quantity;
            existing.totalPrice = existing.amount * existing.price;
        } else {
            checkedProducts.push({
                img: item.image,
                name: item.name,
                price: item.price,
                amount: quantity,
                totalPrice: item.price * quantity,
                type: item.type
            });
        }
        
        localStorage.setItem("checkedProducts", JSON.stringify(checkedProducts));
        
        // Dispatch custom event to update cart badge
        window.dispatchEvent(new Event('cartUpdated'));
        
        showCartModal();
    }

    function showCartModal() {
        const modal = document.getElementById("cart-modal");
        modal.style.display = "flex";
    }

    function closeCartModal() {
        const modal = document.getElementById("cart-modal");
        modal.style.display = "none";
    }
</script>

<!-- Added to Cart Modal -->
<div id="cart-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 9999; align-items: center; justify-content: center;">
    <div class="card animate-fade-in" style="padding: 2rem; text-align: center; max-width: 400px; width: 90%; box-shadow: var(--shadow-lg);">
        <div style="width: 60px; height: 60px; background: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #166534;">
            <i class="ph-fill ph-check" style="font-size: 2.5rem;"></i>
        </div>
        <h3 style="margin-bottom: 0.5rem;">Added to Cart!</h3>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Item has been successfully added to your shopping cart.</p>
        <div style="display: flex; gap: 1rem;">
            <button type="button" onclick="closeCartModal()" class="btn btn-outline" style="flex: 1;">Continue Shopping</button>
            <a href="@Url.Action("Index", "Cart")" class="btn btn-primary" style="flex: 1;">View Cart</a>
        </div>
    </div>
</div>