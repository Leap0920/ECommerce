@{
    ViewBag.Title = "Home Page";
}

<!-- Hero Section -->
<section class="hero-section" style="background: #ffffff; position: relative; overflow: hidden; min-height: 600px; display: flex; align-items: center;">
    <div style="position: absolute; top: 20%; right: 10%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(149, 213, 178, 0.3) 0%, transparent 70%); border-radius: 50%; z-index: 0;"></div>
    <div style="position: absolute; bottom: 10%; left: 5%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(45, 106, 79, 0.2) 0%, transparent 70%); border-radius: 50%; z-index: 0;"></div>
    
    <div class="container" style="position: relative; z-index: 1;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center;">
            <div class="hero-content" data-aos="fade-right" data-aos-duration="600">
                <div style="margin-bottom: 1.5rem;">
                    <span style="display: inline-block; background: rgba(45, 106, 79, 0.1); color: var(--primary); padding: 0.5rem 1.25rem; border-radius: 2rem; font-size: 0.875rem; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;" data-aos="fade-down" data-aos-delay="200">
                        <i class="ph-fill ph-leaf" style="margin-right: 0.5rem;"></i>100% Organic & Fresh
                    </span>
                </div>
                
                <h1 style="font-size: 3.5rem; line-height: 1.1; margin-bottom: 1.5rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 800;" data-aos="fade-up" data-aos-delay="300">
                    Fresh, Organic Produce Delivered Daily
                </h1>
                
                <p style="font-size: 1.2rem; color: var(--text-muted); line-height: 1.8; margin-bottom: 2.5rem; max-width: 500px;" data-aos="fade-up" data-aos-delay="400">
                    Handpicked from local farms. Sustainable, healthy, and delicious vegetables delivered straight to your doorstep within 24 hours.
                </p>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 3rem;" data-aos="fade-up" data-aos-delay="500">
                    <a href="#products" class="btn btn-primary vue-btn" data-vue-btn="hero-shop" style="padding: 1rem 2.5rem; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3);">
                        <i class="ph-bold ph-shopping-bag" style="margin-right: 0.75rem; font-size: 1.25rem;"></i>
                        Shop Now
                    </a>
                    <a href="@Url.Action("About", "Home")" class="btn btn-outline vue-btn" data-vue-btn="hero-learn" style="padding: 1rem 2.5rem; font-size: 1.1rem;">
                        Learn More
                        <i class="ph ph-arrow-right" style="margin-left: 0.75rem; font-size: 1.25rem;"></i>
                    </a>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; padding: 1.5rem 0; border-top: 1px solid rgba(45, 106, 79, 0.2);" data-aos="fade-up" data-aos-delay="600">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 40px; height: 40px; background: rgba(45, 106, 79, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary);">
                            <i class="ph-fill ph-truck" style="font-size: 1.25rem;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Free Delivery</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Orders over ₱1,500</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 40px; height: 40px; background: rgba(45, 106, 79, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary);">
                            <i class="ph-fill ph-leaf" style="font-size: 1.25rem;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.875rem; color: var(--text-main);">100% Organic</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Certified fresh</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 40px; height: 40px; background: rgba(45, 106, 79, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary);">
                            <i class="ph-fill ph-clock" style="font-size: 1.25rem;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; font-size: 0.875rem; color: var(--text-main);">24h Delivery</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Next-day service</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="hero-image" style="position: relative;" data-aos="fade-left" data-aos-duration="600" data-aos-delay="200">
                <div style="position: absolute; top: -20px; right: -20px; width: 100%; height: 100%; background: var(--gradient-primary); opacity: 0.1; border-radius: 1rem; z-index: -1; transform: rotate(3deg);"></div>
                <div style="position: relative; border-radius: 1rem; overflow: hidden; box-shadow: 0 20px 60px rgba(45, 106, 79, 0.3);">
                    <img src="https://images.unsplash.com/photo-1540420773420-3366772f4999?w=800&q=80" 
                         alt="Fresh organic vegetables in a basket" 
                         style="width: 100%; height: auto; display: block; object-fit: cover; border-radius: 1rem;">
                    
                    <div style="position: absolute; bottom: 20px; left: 20px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 1rem 1.5rem; border-radius: 0.75rem; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 50px; height: 50px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="ph-fill ph-star" style="font-size: 1.5rem;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-main);">4.9/5.0</div>
                                <div style="font-size: 0.875rem; color: var(--text-muted);">2,500+ Reviews</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Category Showcase -->
<section class="section" style="padding-top: 4rem; padding-bottom: 4rem; background: #ffffff; position: relative; overflow: hidden;">
    
    <div style="text-align: center; margin-bottom: 4rem; position: relative; z-index: 1;" data-aos="fade-up" data-aos-duration="400">
        <h1 style="font-size: 3rem; margin-bottom: 1rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700;">Shop by Category</h1>
        <p style="font-size: 1.2rem; color: var(--text-muted);">Discover our fresh selection of organic produce</p>
    </div>
    
    <div class="category-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; margin-bottom: 3rem; position: relative; z-index: 1;">
        <a href="#products" onclick="filterByType('leafy'); return false;" class="card category-card" style="padding: 2.5rem; text-align: center; text-decoration: none; cursor: pointer; background: #ffffff; border: 1px solid var(--border); position: relative; overflow: hidden;" data-aos="fade-up" data-aos-delay="0" data-aos-duration="400">
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-primary);"></div>
            <div style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3);">
                <i class="ph-fill ph-leaf" style="font-size: 2.5rem;"></i>
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--text-main); font-weight: 600;">Leafy Vegetables</h3>
            <p style="color: var(--text-muted); margin-bottom: 1rem;">Fresh greens for your salads</p>
            <span style="color: var(--primary); font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem;">Shop Now <i class="ph ph-arrow-right"></i></span>
        </a>
        
        <a href="#products" onclick="filterByType('root'); return false;" class="card category-card" style="padding: 2.5rem; text-align: center; text-decoration: none; cursor: pointer; background: #ffffff; border: 1px solid var(--border); position: relative; overflow: hidden;" data-aos="fade-up" data-aos-delay="50" data-aos-duration="400">
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"></div>
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                <i class="ph-fill ph-carrot" style="font-size: 2.5rem;"></i>
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--text-main); font-weight: 600;">Root Vegetables</h3>
            <p style="color: var(--text-muted); margin-bottom: 1rem;">Nutritious roots from the earth</p>
            <span style="color: var(--primary); font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem;">Shop Now <i class="ph ph-arrow-right"></i></span>
        </a>
        
        <a href="#products" onclick="filterByType('fruit'); return false;" class="card category-card" style="padding: 2.5rem; text-decoration: none; cursor: pointer; background: #ffffff; border: 1px solid var(--border); position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center;" data-aos="fade-up" data-aos-delay="100" data-aos-duration="400">
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"></div>
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="12" cy="14" rx="7" ry="7" fill="white"/>
                    <path d="M12 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="white"/>
                    <path d="M11.5 2.5h1v3h-1z" fill="white"/>
                </svg>
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--text-main); font-weight: 600; text-align: center;">Fruit Vegetables</h3>
            <p style="color: var(--text-muted); margin-bottom: auto; text-align: center;">Sweet and colorful varieties</p>
            <span style="color: var(--primary); font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; margin-top: 1.5rem; align-self: flex-start;">Shop Now <i class="ph ph-arrow-right"></i></span>
        </a>
    </div>
</section>

<!-- Features Section -->
<section class="section features-grid" style="padding: 4rem 0; background: #f8f9fa; display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; position: relative;">
    <div class="card" style="padding: 2.5rem; text-align: center; border: none; background: white; box-shadow: 0 4px 20px rgba(45, 106, 79, 0.1); position: relative; overflow: hidden;" data-aos="fade-up" data-aos-delay="0" data-aos-duration="400">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-primary);"></div>
        <div style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3);">
            <i class="ph-fill ph-truck" style="font-size: 2rem;"></i>
        </div>
        <h3 style="color: var(--text-main); font-weight: 600; margin-bottom: 0.5rem;">Free Delivery</h3>
        <p style="color: var(--text-muted);">Chat mo lang ako sa fb :D </p>
    </div>
    <div class="card" style="padding: 2.5rem; text-align: center; border: none; background: white; box-shadow: 0 4px 20px rgba(45, 106, 79, 0.1); position: relative; overflow: hidden;" data-aos="fade-up" data-aos-delay="50" data-aos-duration="400">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-primary);"></div>
        <div style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3);">
            <i class="ph-fill ph-shield-check" style="font-size: 2rem;"></i>
        </div>
        <h3 style="color: var(--text-main); font-weight: 600; margin-bottom: 0.5rem;">Secure Payment</h3>
        <p style="color: var(--text-muted);">100% secure payment, rekta sa gcash ko.</p>
    </div>
    <div class="card" style="padding: 2.5rem; text-align: center; border: none; background: white; box-shadow: 0 4px 20px rgba(45, 106, 79, 0.1); position: relative; overflow: hidden;" data-aos="fade-up" data-aos-delay="100" data-aos-duration="400">
        <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-primary);"></div>
        <div style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3);">
            <i class="ph-fill ph-headset" style="font-size: 2rem;"></i>
        </div>
        <h3 style="color: var(--text-main); font-weight: 600; margin-bottom: 0.5rem;">24/7 Support</h3>
        <p style="color: var(--text-muted);">Dedicated support, floryn, angela, and rafaela ni Krish Detalla.</p>
    </div>
</section>

<!-- Products Section -->
<section class="section" id="products" style="background: #ffffff;">
    <div class="products-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;" data-aos="fade-up" data-aos-duration="400">
        <div>
            <h2 style="margin-bottom: 0.5rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Our Products</h2>
            <p>Hand-picked fresh for you</p>
        </div>
        
        <!-- Filter Controls -->
        <div style="display: flex; gap: 1rem; align-items: center;" data-aos="fade-left" data-aos-delay="100">
            <div class="form-group" style="margin-bottom: 0;">
                <select class="form-control filter-vege" style="width: 200px;">
                    <option value="all">All Categories</option>
                    <option value="leafy">Leafy Vegetables</option>
                    <option value="root">Root Vegetables</option>
                    <option value="fruit">Fruit Vegetables</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <input type="text" id="search-bar" class="form-control" placeholder="Search products..." style="width: 250px;">
            </div>
        </div>
    </div>

    <!-- Product Grid -->
    <div class="main-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 2rem;" data-aos="fade-up" data-aos-delay="200">
        <!-- Products injected via JS -->
    </div>
</section>

<!-- Product Modal -->
<div class="popup-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease;">
    <div class="product-view card" style="width: 900px; padding: 0; display: flex; flex-direction: row; overflow: hidden; transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
        <!-- Content injected via JS -->
    </div>
</div>

<script type="module">
    // Fetch Data from API
    let data = [];
    
    try {
        const response = await fetch('/api/products');
        const result = await response.json();
        if (result.success) {
            data = result.data;
        } else {
            console.error('Failed to load products:', result.message);
        }
    } catch (err) {
        console.error('API Error:', err);
    }

    let mainGrid = document.querySelector(".main-grid");
    let checkedProducts = JSON.parse(localStorage.getItem("checkedProducts")) || [];

    // Initial Display
    displayer(data);

    // Search Logic (Client-side for now for responsiveness)
    document.getElementById("search-bar").addEventListener("input", function(e) {
        let val = e.target.value.toLowerCase();
        let filtered = data.filter(d => d.Name.toLowerCase().includes(val)); // Note: C# API returns PascalCase properties
        displayer(filtered);
    });

    // Filter function for category cards
    window.filterByType = function(type) {
        document.querySelector(".filter-vege").value = type;
        if (type === "all") displayer(data);
        else displayer(data.filter(d => d.Type.toLowerCase().includes(type.toLowerCase()))); // Use PascalCase Type
        document.getElementById("products").scrollIntoView({ behavior: "smooth" });
    };

    // Filter Logic
    document.querySelector(".filter-vege").addEventListener("change", function(e) {
        let val = e.target.value;
        if (val === "all") displayer(data);
        else displayer(data.filter(d => d.Type.toLowerCase().includes(val.toLowerCase()))); // Use PascalCase Type
    });

    // Display Function
    function displayer(items) {
        mainGrid.innerHTML = "";
        items.forEach((item, index) => {
            let card = document.createElement("div");
            card.className = "card product-card";
            card.setAttribute("data-aos", "fade-up");
            card.setAttribute("data-aos-delay", (index % 6) * 30);
            card.setAttribute("data-aos-duration", "400");
            card.style.padding = "1.5rem";
            card.style.display = "flex";
            card.style.flexDirection = "column";
            card.style.gap = "1rem";
            card.style.cursor = "pointer";
            card.style.background = "#ffffff";
            card.style.border = "1px solid var(--border)";
            card.style.position = "relative";
            card.style.overflow = "visible";
            card.style.transition = "all 0.3s cubic-bezier(0.4, 0, 0.2, 1)";

            const productId = item.Id; // Use ID from database
            card.setAttribute('data-product-id', productId);
            
            card.innerHTML = `
                <div class="gradient-line" style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient-primary); opacity: 0; transition: opacity 0.3s; z-index: 1;"></div>
                <div style="position: relative; height: 200px; display: flex; align-items: center; justify-content: center; background: #f8fafc; border-radius: var(--radius-sm); margin-bottom: 0.5rem; overflow: visible;">
                    <img src="${item.Image}" alt="${item.Name}" style="max-width: 80%; max-height: 80%; object-fit: contain; transition: transform 0.3s;">
                    <button type="button" class="icon-btn heart-btn" data-product-id="${productId}" style="position: absolute; top: 10px; right: 10px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.15); z-index: 1000 !important; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer !important; border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; pointer-events: auto !important; outline: none; -webkit-user-select: none; user-select: none;" title="Add to favorites">
                        <i class="ph ph-heart" data-heart-icon style="transition: all 0.2s ease; font-size: 1.25rem; pointer-events: none;"></i>
                    </button>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3 style="font-size: 1.1rem; margin: 0;">${item.Name}</h3>
                        <span style="font-weight: 700; color: var(--primary);">₱${item.Price}</span>
                    </div>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${item.Description}</p>
                </div>
                <button class="btn btn-primary add-btn vue-btn" style="width: 100%; margin-top: auto; background: var(--gradient-button); border: none; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
                    <i class="ph-bold ph-shopping-cart" style="margin-right: 0.5rem;"></i> Add to Cart
                </button>
            `;

            // Heart button functionality
            const heartBtn = card.querySelector(".heart-btn");
            const heartIcon = card.querySelector("[data-heart-icon]");
            
            // Function to update heart icon appearance
            function updateHeartIcon(isFavorited) {
                if (isFavorited) {
                    heartIcon.className = "ph-fill ph-heart";
                    heartIcon.style.color = "#ef4444";
                    heartBtn.setAttribute('data-favorited', 'true');
                } else {
                    heartIcon.className = "ph ph-heart";
                    heartIcon.style.color = "";
                    heartBtn.setAttribute('data-favorited', 'false');
                }
            }
            
            // Load initial favorite state
            try {
                const favorites = JSON.parse(localStorage.getItem("favorites")) || [];
                updateHeartIcon(favorites.includes(productId));
            } catch (e) {
                updateHeartIcon(false);
            }
            
            // Heart button click handler using addEventListener with capture
            heartBtn.addEventListener("click", function(e) {
                e.stopPropagation();
                e.stopImmediatePropagation();
                e.preventDefault();
                
                console.log("Heart clicked:", productId);
                
                // Animation
                this.style.transform = "scale(1.3)";
                setTimeout(() => { this.style.transform = "scale(1)"; }, 200);
                
                try {
                    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
                    const index = favorites.indexOf(productId);
                    
                    if (index > -1) {
                        favorites.splice(index, 1);
                        updateHeartIcon(false);
                    } else {
                        favorites.push(productId);
                        updateHeartIcon(true);
                    }
                    
                    localStorage.setItem("favorites", JSON.stringify(favorites));
                    window.dispatchEvent(new CustomEvent('favoritesUpdated', { detail: { productId } }));
                } catch (e) {
                    console.error("Error:", e);
                }
            }, true); // Capture phase
            
            // Prevent mousedown from propagating
            heartBtn.addEventListener("mousedown", (e) => e.stopPropagation(), true);
            
            // Hover effects
            heartBtn.addEventListener("mouseenter", function() {
                if (this.getAttribute('data-favorited') !== 'true') {
                    this.style.transform = "scale(1.1)";
                    heartIcon.style.color = "var(--primary)";
                }
            });
            heartBtn.addEventListener("mouseleave", function() {
                if (this.getAttribute('data-favorited') !== 'true') {
                    this.style.transform = "scale(1)";
                    heartIcon.style.color = "";
                }
            });

            // Card Click Event for Modal (ignore heart button)
            card.addEventListener("click", (e) => {
                if (!e.target.closest('.heart-btn') && !e.target.closest('.add-btn')) {
                    openModal(item);
                }
            });

            // Add to Cart Event
            const addBtn = card.querySelector(".add-btn");
            addBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                addBtn.style.transform = "scale(0.95)";
                setTimeout(() => addBtn.style.transform = "translateY(-2px)", 150);
                addToCart(item, 1);
            });
            
            addBtn.addEventListener("mouseenter", () => addBtn.classList.add('vue-btn-hover'));
            addBtn.addEventListener("mouseleave", () => addBtn.classList.remove('vue-btn-hover'));

            // Card Hover Effects
            card.addEventListener("mouseenter", function() {
                const gradientLine = this.querySelector(".gradient-line");
                if (gradientLine) gradientLine.style.opacity = "1";
                this.style.transform = "translateY(-4px)";
                this.style.boxShadow = "0 8px 24px rgba(45, 106, 79, 0.15)";
                const img = this.querySelector("img");
                if (img) img.style.transform = "scale(1.05)";
            });
            
            card.addEventListener("mouseleave", function() {
                const gradientLine = this.querySelector(".gradient-line");
                if (gradientLine) gradientLine.style.opacity = "0";
                this.style.transform = "translateY(0)";
                this.style.boxShadow = "";
                const img = this.querySelector("img");
                if (img) img.style.transform = "scale(1)";
            });

            mainGrid.appendChild(card);
        });
        
        if (typeof AOS !== 'undefined') AOS.refresh();
    }

    // Modal Logic
    const modal = document.querySelector(".popup-container");
    const modalContent = document.querySelector(".product-view");

    function openModal(item) {
        modal.style.display = "flex";
        setTimeout(() => {
            modal.style.opacity = "1";
            modalContent.style.transform = "scale(1)";
        }, 10);
        let qty = 1;
        
        modalContent.innerHTML = `
            <div style="flex: 1; background: #f8fafc; padding: 3rem; display: flex; align-items: center; justify-content: center;">
                <img src="${item.Image}" style="max-width: 100%; max-height: 300px; object-fit: contain;">
            </div>
            <div style="flex: 1; padding: 3rem; display: flex; flex-direction: column; gap: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <span style="color: var(--primary); font-weight: 600; text-transform: uppercase; font-size: 0.85rem;">${item.Type}</span>
                        <h2 style="margin: 0.5rem 0;">${item.Name}</h2>
                    </div>
                    <button id="close-modal" class="icon-btn"><i class="ph-bold ph-x"></i></button>
                </div>
                
                <h3 style="color: var(--primary); font-size: 2rem;">₱${item.Price}</h3>
                <p style="color: var(--text-muted); line-height: 1.7;">${item.Description}</p>
                
                <div style="margin-top: auto;">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; border: 1px solid var(--border); border-radius: var(--radius-sm);">
                            <button class="icon-btn" id="minus" style="border-radius: 0;">-</button>
                            <span id="qty-display" style="width: 40px; text-align: center; font-weight: 600;">1</span>
                            <button class="icon-btn" id="plus" style="border-radius: 0;">+</button>
                        </div>
                        <button class="btn btn-primary" id="modal-add" style="flex: 1;">Add to Cart - ₱${item.Price}</button>
                    </div>
                </div>
            </div>
        `;

        // Modal Events
        document.getElementById("close-modal").onclick = () => {
            modal.style.opacity = "0";
            modalContent.style.transform = "scale(0.9)";
            setTimeout(() => modal.style.display = "none", 300);
        };
        
        document.getElementById("plus").onclick = () => {
            qty++;
            updateModalQty(qty, item.Price);
        };
        
        document.getElementById("minus").onclick = () => {
            if (qty > 1) qty--;
            updateModalQty(qty, item.Price);
        };

        document.getElementById("modal-add").onclick = () => {
            addToCart(item, qty);
            modal.style.opacity = "0";
            modalContent.style.transform = "scale(0.9)";
            setTimeout(() => modal.style.display = "none", 300);
        };
    }

    function updateModalQty(q, price) {
        document.getElementById("qty-display").textContent = q;
        document.getElementById("modal-add").textContent = `Add to Cart - ₱${(q * price).toFixed(2)}`;
    }

    // Close modal on outside click
    modal.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.style.opacity = "0";
            modalContent.style.transform = "scale(0.9)";
            setTimeout(() => modal.style.display = "none", 300);
        }
    });

    // Cart Logic
    function addToCart(item, quantity) {
        let existing = checkedProducts.find(p => p.id === item.Id);
        
        if (existing) {
            existing.amount += quantity;
            existing.totalPrice = existing.amount * existing.price;
        } else {
            checkedProducts.push({
                id: item.Id, // Store ID
                img: item.Image,
                name: item.Name,
                price: item.Price,
                amount: quantity,
                totalPrice: item.Price * quantity,
                type: item.Type
            });
        }
        
        localStorage.setItem("checkedProducts", JSON.stringify(checkedProducts));
        
        // Dispatch custom event to update cart badge
        window.dispatchEvent(new Event('cartUpdated'));
        
        // API Call to add to persistent cart if user is logged in
        fetch('/api/cart/add', {
            method: 'POST',
            body: new URLSearchParams({
                productId: item.Id,
                quantity: quantity
            })
        }).catch(err => console.log('Cart sync error (likely not logged in):', err));
        
        showCartModal();
    }

    function showCartModal() {
        const modal = document.getElementById("cart-modal");
        const modalContent = modal.querySelector('.vue-modal-content');
        if (modal && modalContent) {
            modal.style.display = "flex";
            // Vue animation - fade in
            setTimeout(() => {
                modal.style.opacity = "1";
                modalContent.style.transform = "scale(1)";
            }, 10);
        } else if (modal) {
             // Fallback if vue-modal-content class is missing
             modal.style.display = "flex";
        }
    }

    function closeCartModal() {
        const modal = document.getElementById("cart-modal");
        const modalContent = modal ? modal.querySelector('.vue-modal-content') : null;
        if (modal && modalContent) {
            // Vue animation - fade out
            modal.style.opacity = "0";
            modalContent.style.transform = "scale(0.9)";
            setTimeout(() => {
                modal.style.display = "none";
            }, 300);
        } else if (modal) {
             modal.style.display = "none";
        }
    }
    
    // Make closeCartModal globally accessible
    window.closeCartModal = closeCartModal;
</script>

<!-- Added to Cart Modal -->
<div id="cart-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 9999; align-items: center; justify-content: center;">
    <div class="card vue-modal-content" style="padding: 2rem; text-align: center; max-width: 400px; width: 90%; box-shadow: var(--shadow-lg); transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
        <div style="width: 60px; height: 60px; background: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #166534;">
            <i class="ph-fill ph-check" style="font-size: 2.5rem;"></i>
        </div>
        <h3 style="margin-bottom: 0.5rem;">Added to Cart!</h3>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Item has been successfully added to your shopping cart.</p>
        <div style="display: flex; gap: 1rem;">
            <button type="button" onclick="closeCartModal()" class="btn btn-outline" style="flex: 1;">Continue Shopping</button>
            <a href="@Url.Action("Index", "Cart")" class="btn btn-primary" style="flex: 1;">View Cart</a>
        </div>
    </div>
</div>